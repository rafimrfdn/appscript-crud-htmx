<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title></title>
  <script src="https://unpkg.com/htmx.org@1.9.10"
    integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC"
    crossorigin="anonymous"></script>
    </head>
    <body>
        <form method="POST">
            <input type="text" name="id" value="" placeholder="enter id">
            <input type="text" name="username" value="" placeholder="enter username">
            <input type="text" name="email" value="" placeholder="enter email">
            <button type="submit" hx-get="/submit" hx-include="find input" hx-target="#response">kirim</button>
        </form>
        <div id="response"></div>

        <!-- <button hx-get="/lihat" hx-target="#values">lihatt</button> -->
        <button hx-get="/lihat" hx-target="#values">lihatt</button>
        <!-- <button hx-get="/fetchData" hx-target="#values">fetch data</button> -->
        <button hx-trigger="load, click" hx-get="/fetchData" hx-target="#values">fetch data</button>
        <div id="values"></div>
        <ul></ul>
        <script>

        function submitData(event) {
            event.preventDefault();

            // Get form values
            var id = document.getElementById("id").value;
            var username = document.getElementById("username").value;
            var email = document.getElementById("email").value;

            // Get current timestamp
            var timestamp = Math.floor(Date.now() / 1000);

            // Get current time and format it
            var currentTime = formatDate(new Date());

            // Construct data parameter
            var data = {
                id: id,
                username: username,
                email: email,
                timestamp: timestamp,
                currentTime: currentTime
            };

            // Encode data parameter
            var encodedData = encodeURIComponent(JSON.stringify(data));

            // Construct URL with endpoint
            var url = "https://script.google.com/macros/s/AKfycbyaLyPo6_F_Shgza5Y8RWvjd94T99xBYQ2u_yuPqD9V-02HOliFqc5cX31UC9KsryBb/exec?action=insert&table=Users&data=" + encodedData;

            // Send AJAX request
            var xhr = new XMLHttpRequest();
            xhr.open("GET", url, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        // Request was successful, display success message
                        alert("Data successfully sent!");
                        
                    } else {
                        // Request failed, display error message
                        alert("Error: Unable to send data. Please try again later.");
                    }
                }
            };
            xhr.send();


        }

        // Function to format date as "MM/DD/YYYY HH:MM:SS"
        function formatDate(date) {
            var month = date.getMonth() + 1;
            var day = date.getDate();
            var year = date.getFullYear();
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var seconds = date.getSeconds();

            return month + '/' + day + '/' + year + ' ' + hours + ':' + minutes + ':' + seconds;
        }


        </script>
    </body>
</html>
